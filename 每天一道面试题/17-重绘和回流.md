# 浏览器渲染机制
  ## 浏览器渲染过程如下：
    解析HTML，生成DOM树，解析CSS，生成CSSOM树
    将DOM树和CSSOM树结合，生成渲染树(Render Tree)
    Layout(回流):根据生成的渲染树，进行回流(Layout)，得到节点的几何信息（位置，大小）
    Painting(重绘):根据渲染树以及回流得到的几何信息，得到节点的绝对像素
    Display:将像素发送给GPU，展示在页面上。
    为了构建渲染树，浏览器主要完成了以下工作：
      从DOM树的根节点开始遍历每个可见节点。
      对于每个可见的节点，找到CSSOM树中对应的规则，并应用它们。
      根据每个可见节点以及其对应的样式，组合生成渲染树。
      第一步中，既然说到了要遍历可见的节点，那么我们得先知道，什么节点是不可见的。不可见的节点包括：
        一些不会渲染输出的节点，比如script、meta、link等。
        一些通过css进行隐藏的节点。比如display:none。注意，利用visibility和opacity隐藏的节点，还是会显示在渲染树上的。只有display:none的节点才不会显示在渲染树上。
      如果标签的样式有一个display:none，它最终不会在渲染树上。
    注意：渲染树只包含可见的节点
# 重绘
  最终，我们通过构造渲染树和回流阶段，我们知道了哪些节点是可见的，以及可见节点的样式和具体的几何信息(位置、大小)，那么我们就可以将渲染树的每个节点都转换为屏幕上的实际像素，这个阶段就叫做重绘节点。
# 回流
  前面我们通过构造渲染树，我们将可见DOM节点以及它对应的样式结合起来，可是我们还需要计算它们在设备视口(viewport)内的确切位置和大小，这个计算的阶段就是回流。
  回流是布局或者几何属性需要改变就称为回流。回流是影响浏览器性能的关键因素，因为其变化涉及到部分页面（或是整个页面）的布局更新。一个元素的回流可能会导致了其所有子元素以及DOM中紧随其后的节点、祖先节点元素的随后的回流。
  以下会引起回流；
    添加或删除可见的DOM元素
    元素的位置发生变化
    元素的尺寸发生变化（包括外边距、内边框、边框大小、高度和宽度等）
    内容发生变化，比如文本变化或图片被另一个不同尺寸的图片所替代。
    页面一开始渲染的时候（这肯定避免不了）
    浏览器的窗口尺寸变化（因为回流是根据视口的大小来计算元素的位置和大小的）    
  注意：大部分的回流将导致页面的重新渲染。回流必定会发生重绘，重绘不一定会引发回流。
# 浏览器优化
  现代浏览器大多都是通过队列机制来批量更新布局，浏览器会把修改操作放在队列中，至少一个浏览器刷新（即16.6ms）才会清空队列，但当你获取布局信息的时候，队列中可能有会影响这些属性或方法返回值的操作，即使没有，浏览器也会强制清空队列，触发回流与重绘来确保返回正确的值。
  主要包括以下属性或方法：
    offsetTop、offsetLeft、offsetWidth、offsetHeight
    scrollTop、scrollLeft、scrollWidth、scrollHeight
    clientTop、clientLeft、clientWidth、clientHeight
    width、height
    getComputedStyle()
    getBoundingClientRect()
#  减少重绘与回流
  css
    使用 transform 替代 top
    使用 visibility 替换 display: none ，因为前者只会引起重绘，后者会引发回流（改变了布局）
    避免使用table布局，可能很小的一个小改动会造成整个 table 的重新布局。
    尽可能在DOM树的最末端改变class，回流是不可避免的，但可以减少其影响。尽可能在DOM树的最末端改变class，可以限制了回流的范围，使其影响尽可能少的节点。
    避免设置多层内联样式，CSS 选择符从右往左匹配查找，避免节点层级过多。
    将动画效果应用到position属性为absolute或fixed的元素上，避免影响其他元素的布局，这样只是一个重绘，而不是回流，同时，控制动画速度可以选择 requestAnimationFrame，详见探讨 requestAnimationFrame。
    避免使用CSS表达式，可能会引发回流。
    将频繁重绘或者回流的节点设置为图层，图层能够阻止该节点的渲染行为影响别的节点，例如will-change、video、iframe等标签，浏览器会自动将该节点变为图层。
    CSS3 硬件加速（GPU加速），使用css3硬件加速，可以让transform、opacity、filters这些动画不会引起回流重绘 。但是对于动画的其它属性，比如background-color这些，还是会引起回流重绘的，不过它还是可以提升这些动画的性能。  
  js
    避免频繁操作样式，最好一次性重写style属性，或者将样式列表定义为class并一次性更改class属性。
    避免频繁操作DOM，创建一个documentFragment，在它上面应用所有DOM操作，最后再把它添加到文档中。
    避免频繁读取会引发回流/重绘的属性，如果确实需要多次使用，就用一个变量缓存起来。
    对具有复杂动画的元素使用绝对定位，使它脱离文档流，否则会引起父元素及后续元素频繁回流。